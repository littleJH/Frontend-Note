# ä»£ç†æ¨¡å¼

å¸¸è§åº”ç”¨åœºæ™¯ï¼šäº‹ä»¶ä»£ç†ã€è™šæ‹Ÿä»£ç†ã€ç¼“å­˜ä»£ç†ã€ä¿æŠ¤ä»£ç†

### äº‹ä»¶ä»£ç†

å€ŸåŠ©äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå°†å­å…ƒç´ çš„äº‹ä»¶ç»Ÿä¸€ç»‘å®šåˆ°çˆ¶å…ƒç´ ä¸Šï¼Œç”±çˆ¶å…ƒç´ å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†å’Œåˆ†å‘ã€‚

### è™šæ‹Ÿä»£ç†

ä¸»è¦ç”¨äºå»¶è¿ŸåŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰æˆ–æŒ‰éœ€åŠ è½½èµ„æºï¼Œä»è€ŒèŠ‚çœèµ„æºå’Œæ€§èƒ½

å»¶è¿ŸåŠ è½½å›¾ç‰‡

```jsx
class MyImg {
  constructor(imgNode) {
    // è·å–çœŸå®DOM
    this.imgNode = imgNode
  }

  // æ“ä½œçœŸå® img çš„ src å±æ€§
  setSrc(url) {
    this.imgNode.src = url
  }
}

class ProxyImg {
  // å ä½å›¾ç‰‡url
  static loading_url = 'https://example.com/loading-image.jpg'

  constructor(myImg) {
    this.myImg = myImg
  }

  // æ“ä½œè™šæ‹Ÿ img çš„srcå±æ€§ï¼Œå®Œæˆå›¾ç‰‡èµ„æºçš„åŠ è½½
  setSrc(url) {
    // ä¸ºçœŸå® img æ·»åŠ å ä½å›¾
    this.myImg.setSrc(this.loading_url)
    // æ–°å»ºä¸€ä¸ªè™šæ‹Ÿ img
    const vImg = new Image()
    // ä¸ºè™šæ‹Ÿ img æ·»åŠ  onload äº‹ä»¶
    vImg.onload = () => {
      // åŠ è½½å®Œæˆåè®¾ç½®çœŸå® img çš„ src
      this.myImg.setSrc(url)
    }
    // åŠ è½½å›¾ç‰‡èµ„æº
    vImg.src = url
  }
}

const imgEl = document.querySelector('#myImg')
const myImg = new MyImg(imgEl)
const proxyIMg = new ProxyImg(myImg)

// åœ¨éœ€è¦çš„æ—¶å€™åŠ è½½å›¾ç‰‡èµ„æº
proxyIMg.setSrc('xxx')

```

### ç¼“å­˜ä»£ç†

å®ç°æ–¹å¼ï¼šé—­åŒ…

```jsx
const proxyCache = function (caculateFn) {
	// ç”¨ Map ç¼“å­˜è®¡ç®—ç»“æœ
  const resultCache = new Map()
  return function () {
	  // å‡½æ•°ä½“å­—ç¬¦ä¸²åºåˆ—+å‚æ•°åºåˆ—ï¼Œä½œä¸º map çš„é”®
    const key = `${JSON.stringify(caculateFn)}_${Array.prototype.join.apply(arguments)}`
    if (!resultCache.has(key)) {
      console.log('è®¡ç®—')
      resultCache.set(key, caculateFn.apply(this, arguments))
    }
    return resultCache.get(key)
  }
}

const addCache = proxyCache((a, b) => a + b)

console.log("ğŸš€ ~ addCache(1, 2):", addCache(1, 2))
console.log("ğŸš€ ~ addCache(1, 2):", addCache(1, 2))
```

### ä¿æŠ¤ä»£ç†

å…¸å‹åº”ç”¨ï¼šES6 çš„ proxy